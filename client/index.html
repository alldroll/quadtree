<!DOCTYPE html>
<head>
    <style type="text/css">
        html, body { height: 100%; margin: 0; padding: 0; }
        #map { height: 800px; width: 600px }
    </style>
    <meta charset="utf-8">
</head>
<body>
    <div id="map"></div>
    <script type="text/javascript">

        function initMap() {
            var ws = new WebSocket("{{.WSPath}}");
            var map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 43.124365, lng: 131.889356},
                zoom: {{.Zoom}}
            });

            var showMarkers = function() {
                var bounds = map.getBounds();
                console.log(bounds);
                var toSend = {
                    lat1: bounds.b.b,
                    lon1: bounds.f.f,
                    lat2: bounds.b.f,
                    lon2: bounds.f.b
                };

                console.log(JSON.stringify(toSend))

                ws.send(JSON.stringify(toSend))
            };

            ws.onmessage = function(event) {
                console.log(event.data.length)
            };

            map.addListener('idle', showMarkers);
        }
    </script>

    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key={{.ApiKey}}&callback=initMap">
    </script>
</body>
</html>
